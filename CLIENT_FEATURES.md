# HKCE Cloud 客户端特性说明

## 概述

HKCE Cloud 是一个基于 Wails 框架开发的现代化桌面网盘应用，集成了丰富的客户端特性，提供类似群晖 Drive 的用户体验。

## 新增客户端特性

### 1. 系统托盘集成
- **功能**: 应用可以最小化到系统托盘，支持后台运行
- **特性**:
  - 托盘图标显示应用状态
  - 右键菜单提供快速操作
  - 支持显示/隐藏主窗口
  - 同步状态切换
  - 快速访问设置
  - 退出应用

### 2. 自动更新机制
- **功能**: 自动检查和下载应用更新
- **特性**:
  - 定期检查更新（可配置间隔）
  - 版本比较和更新通知
  - 支持手动检查更新
  - 更新历史记录
  - 强制更新支持

### 3. 文件系统监控
- **功能**: 实时监控文件变化，支持自动同步
- **特性**:
  - 使用 fsnotify 库监控文件系统事件
  - 支持文件创建、修改、删除、重命名事件
  - 自动触发同步操作
  - 事件日志记录
  - 前端实时通知

### 4. 系统通知
- **功能**: 跨平台系统通知支持
- **特性**:
  - Windows、macOS、Linux 通知支持
  - 同步状态通知
  - 错误和警告通知
  - 更新可用通知
  - 可配置通知开关

### 5. 开机自启动
- **功能**: 系统启动时自动运行应用
- **特性**:
  - Windows 注册表集成
  - macOS LaunchAgent 支持
  - Linux .desktop 文件支持
  - 可通过设置界面控制

### 6. 窗口状态管理
- **功能**: 记住窗口位置和大小
- **特性**:
  - 自动保存窗口状态
  - 应用重启后恢复窗口位置
  - 支持多显示器环境
  - 最小化到托盘选项

### 7. 单实例应用
- **功能**: 防止多个应用实例同时运行
- **特性**:
  - 应用锁定机制
  - 第二次启动时激活现有窗口
  - 参数传递支持
  - 优雅的实例切换

## 技术架构

### 后端架构
```
app.go                 # 主应用结构和生命周期管理
├── client_features.go # 客户端特性管理器
├── types.go          # 数据结构定义
├── auth.go           # 用户认证
├── file_operations.go # 文件操作
├── minio_operations.go # MinIO 云存储
└── iscsi_client.go   # iSCSI 客户端
```

### 前端架构
```
frontend/src/
├── App.vue                    # 主应用组件
├── components/
│   ├── SystemSettings.vue    # 系统设置组件
│   ├── Login.vue            # 登录组件
│   ├── FilePreview.vue      # 文件预览
│   ├── MinioConfig.vue      # MinIO 配置
│   ├── MinioFiles.vue       # MinIO 文件管理
│   └── ISCSIInitiator.vue   # iSCSI 客户端
└── main.js                  # 应用入口
```

### 关键依赖
- **fsnotify**: 文件系统监控
- **Wails v2**: 桌面应用框架
- **Arco Design**: UI 组件库
- **Vue 3**: 前端框架

## 使用说明

### 系统设置
1. 点击侧边栏的"系统设置"菜单
2. 在设置界面中可以配置：
   - 开机自启动
   - 系统托盘行为
   - 通知设置
   - 同步配置
   - 更新检查
   - 高级选项

### 托盘操作
1. 最小化应用到系统托盘
2. 右键托盘图标查看菜单
3. 双击托盘图标恢复窗口

### 文件同步
1. 配置 MinIO 云存储
2. 启用自动同步
3. 文件变化会自动触发同步
4. 在同步中心查看同步状态

### 更新管理
1. 应用会自动检查更新
2. 有新版本时会显示通知
3. 可以手动检查更新
4. 查看更新历史记录

## 开发说明

### 编译应用
```bash
# 开发模式
wails dev

# 构建生产版本
wails build
```

### 测试客户端特性
```bash
# 运行测试
go run test_client_features.go
```

### 添加新特性
1. 在 `client_features.go` 中添加新功能
2. 在 `app.go` 中添加对应的 API 方法
3. 在前端组件中添加 UI 界面
4. 更新系统设置界面

## 配置文件

### 应用配置 (config.json)
```json
{
  "minio": {
    "endpoint": "play.min.io",
    "accessKeyID": "minioadmin",
    "secretAccessKey": "minioadmin",
    "useSSL": true,
    "bucketName": "hkce-cloud",
    "enabled": false
  }
}
```

### 窗口状态 (window_state.json)
```json
{
  "x": 100,
  "y": 100,
  "width": 1400,
  "height": 900,
  "time": "2024-01-15T10:30:00Z"
}
```

## 故障排除

### 常见问题
1. **托盘图标不显示**: 检查系统托盘设置
2. **自启动不工作**: 检查系统权限设置
3. **文件监控失效**: 检查文件系统权限
4. **通知不显示**: 检查系统通知权限

### 日志查看
- 应用日志会输出到控制台
- 可以通过设置界面调整日志级别
- 错误信息会显示在同步状态中

## 版本历史

### v1.0.0 (2024-01-15)
- 初始版本发布
- 基本文件管理功能
- MinIO 云存储集成
- iSCSI 客户端功能
- 现代化客户端特性

## 贡献指南

1. Fork 项目
2. 创建特性分支
3. 提交更改
4. 创建 Pull Request

## 许可证

本项目采用 MIT 许可证。